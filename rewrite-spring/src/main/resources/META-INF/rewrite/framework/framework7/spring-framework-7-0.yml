# Based on https://github.com/spring-projects/spring-framework/wiki/Spring-Framework-7.0-Release-Notes
---
type: specs.openrewrite.org/v1beta/recipe
name: io.arconia.rewrite.spring.framework7.UpgradeSpringFramework_7_0
displayName: Migrate to Spring Framework 7.0
description: Migrate a Spring application to the latest Spring Framework 7.0.x release.
tags:
  - spring
  - framework
recipeList:

  # Dependency Versions
  - org.openrewrite.java.dependencies.UpgradeDependencyVersion:
      groupId: org.springframework
      artifactId: "*"
      newVersion: 7.0.x

  # Managed Dependencies
  - org.openrewrite.java.jackson.UpgradeJackson_2_3
  - io.arconia.rewrite.test.junit.UpgradeJUnit_6

  # Spring Framework Modules
  - io.arconia.rewrite.spring.framework7.MigrateSpringCore_7_0
  - io.arconia.rewrite.spring.framework7.MigrateSpringTest_7_0
  - io.arconia.rewrite.spring.framework7.MigrateSpringWeb_7_0
  - io.arconia.rewrite.spring.framework7.MigrateSpringWebFlux_7_0
  - io.arconia.rewrite.spring.framework7.MigrateSpringWebMvc_7_0

---
type: specs.openrewrite.org/v1beta/recipe
name: io.arconia.rewrite.spring.framework7.MigrateSpringCore_7_0
displayName: Migrate the Spring Core module to Spring Framework 7.0
recipeList:
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: org.springframework.lang.Nullable
      newFullyQualifiedTypeName: org.jspecify.annotations.Nullable
  - org.openrewrite.java.ChangeMethodName:
      methodPattern: org.springframework.aot.hint.support.FilePatternResourceHintsRegistrar$Builder withClasspathLocations(..)
      newMethodName: withClassPathLocations
  - org.openrewrite.java.ReplaceConstantWithAnotherConstant:
      existingFullyQualifiedConstantName: org.springframework.aot.hint.MemberCategory.DECLARED_FIELDS
      fullyQualifiedConstantName: org.springframework.aot.hint.MemberCategory.INVOKE_DECLARED_FIELDS
  - org.openrewrite.java.ReplaceConstantWithAnotherConstant:
      existingFullyQualifiedConstantName: org.springframework.aot.hint.MemberCategory.PUBLIC_FIELDS
      fullyQualifiedConstantName: org.springframework.aot.hint.MemberCategory.INVOKE_PUBLIC_FIELDS

---
type: specs.openrewrite.org/v1beta/recipe
name: io.arconia.rewrite.spring.framework7.MigrateSpringTest_7_0
displayName: Migrate the Spring Test module to Spring Framework 7.0
recipeList:
  - org.openrewrite.java.ChangeMethodName:
      methodPattern: org.springframework.test.web.servlet.result.StatusResultMatchers isPayloadTooLarge()
      newMethodName: isContentTooLarge
      matchOverrides: true
  - org.openrewrite.java.ChangeMethodName:
      methodPattern: org.springframework.test.web.servlet.result.StatusResultMatchers isUnprocessableEntity()
      newMethodName: isUnprocessableContent
      matchOverrides: true

---
type: specs.openrewrite.org/v1beta/recipe
name: io.arconia.rewrite.spring.framework7.MigrateSpringWeb_7_0
displayName: Migrate the Spring Web module to Spring Framework 7.0
recipeList:
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: org.springframework.http.converter.json.Jackson2ObjectMapperBuilder
      newFullyQualifiedTypeName: tools.jackson.databind.json.JsonMapper$Builder
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: org.springframework.web.server.PayloadTooLargeException
      newFullyQualifiedTypeName: org.springframework.web.server.ContentTooLargeException
  - org.openrewrite.java.ChangeMethodName:
      methodPattern: org.springframework.http.ResponseEntity unprocessableEntity()
      newMethodName: unprocessableContent
  - org.openrewrite.java.ReplaceConstantWithAnotherConstant:
      existingFullyQualifiedConstantName: org.springframework.http.HttpStatus.PAYLOAD_TOO_LARGE
      fullyQualifiedConstantName: org.springframework.http.HttpStatus.CONTENT_TOO_LARGE
  - org.openrewrite.java.ReplaceConstantWithAnotherConstant:
      existingFullyQualifiedConstantName: org.springframework.http.HttpStatus.UNPROCESSABLE_ENTITY
      fullyQualifiedConstantName: org.springframework.http.HttpStatus.UNPROCESSABLE_CONTENT

---
type: specs.openrewrite.org/v1beta/recipe
name: io.arconia.rewrite.spring.framework7.MigrateSpringWebFlux_7_0
displayName: Migrate the Spring WebFlux module to Spring Framework 7.0
recipeList:
  - org.openrewrite.java.ChangeMethodName:
      methodPattern: org.springframework.web.reactive.function.server.ServerResponse unprocessableEntity()
      newMethodName: unprocessableContent
      matchOverrides: true
  - org.openrewrite.java.ChangeMethodName:
      methodPattern: org.springframework.web.reactive.result.view.FragmentsRendering with(..)
      newMethodName: fragment
      matchOverrides: true
  - org.openrewrite.java.ChangeMethodName:
      methodPattern: org.springframework.web.reactive.result.view.FragmentsRendering withCollection(..)
      newMethodName: fragments
      matchOverrides: true
  - org.openrewrite.java.ChangeMethodName:
      methodPattern: org.springframework.web.reactive.result.view.FragmentsRendering withPublisher(..)
      newMethodName: fragmentsPublisher
      matchOverrides: true
  - org.openrewrite.java.ChangeMethodName:
      methodPattern: org.springframework.web.reactive.result.view.FragmentsRendering withProducer(..)
      newMethodName: fragmentsProducer
      matchOverrides: true
  - org.openrewrite.java.ChangeType:
      oldFullyQualifiedTypeName: org.springframework.web.reactive.function.client.WebClientResponseException$UnprocessableEntity
      newFullyQualifiedTypeName: org.springframework.web.reactive.function.client.WebClientResponseException$UnprocessableContent

---
type: specs.openrewrite.org/v1beta/recipe
name: io.arconia.rewrite.spring.framework7.MigrateSpringWebMvc_7_0
displayName: Migrate the Spring WebMVC module to Spring Framework 7.0
recipeList:
  - org.openrewrite.java.ChangeMethodName:
      methodPattern: org.springframework.web.servlet.function.ServerResponse unprocessableEntity()
      newMethodName: unprocessableContent
  - org.openrewrite.java.ChangeMethodName:
      methodPattern: org.springframework.web.servlet.view.FragmentsRendering with(String)
      newMethodName: fragment
      matchOverrides: true
  - org.openrewrite.java.ChangeMethodName:
      methodPattern: org.springframework.web.servlet.view.FragmentsRendering with(String, java.util.Map)
      newMethodName: fragment
      matchOverrides: true
  - org.openrewrite.java.ChangeMethodName:
      methodPattern: org.springframework.web.servlet.view.FragmentsRendering with(java.util.Collection)
      newMethodName: fragments
      matchOverrides: true
  - org.openrewrite.java.ReplaceConstantWithAnotherConstant:
      existingFullyQualifiedConstantName: org.springframework.web.servlet.support.RequestContext.jstlPresent
      fullyQualifiedConstantName: org.springframework.web.servlet.support.RequestContext.JSTL_PRESENT
